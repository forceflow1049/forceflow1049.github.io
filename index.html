<!DOCTYPE html>
<html lang="en">
<head>
  <title>Talking Time Tracker</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.bundle.min.js"></script>

  <!-- Load my stylesheet -->
  <link rel="stylesheet" href="stylesheet.css">
</head>
<body>

<div class="container-fluid">
  <div class='row mt-2 ml-1'>
    <h2>Talking Time Tracker</h2>
  </div>

  <ul class="nav nav-pills">
  <li class="nav-item">
    <a class="nav-link active" data-toggle="pill" href="#speakersTab">Speakers</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" data-toggle="pill" href="#chartsTab">Charts</a>
  </li>
  <li class="nav-item">
    <a class="nav-link" data-toggle="pill" href="#aboutTab">About</a>
  </li>
</ul>

<!-- Tab panes -->
<div class="tab-content">
  <div class="tab-pane container active col-12" id="speakersTab">

    <form onsubmit="return tc.createTimedEntity()">
       <div class="row mt-3">
           <div class="col-8 col-sm-6 col-md-5 col-lg-4 col-xl-2">
             <input type="text" class="form-control" id="newNameInput" aria-describedby="newNameHelp" placeholder="Enter unique name">
           </div>
           <div class="col-4">
             <button type="button" class="btn btn-primary" id="addTimedEntityButton">Add</button>
           </div>
       </div>
    </form>
     <div class="row mt-3">
       <div class="col-auto">
         <button type="button" class="btn btn-warning" id="toggleTiming">Start Timing</button>
       </div>
       <div class="col-auto">
         <button type="button" class="btn btn-secondary" id="noSpeakerButton">No Speaker</button>
       </div>
     </div>

    <div id='timedEtityButtons' class='row'>
    </div>

  </div>
  <div class="tab-pane container fade col-12" id="chartsTab">
    <div class="row mt-3">
      <div class="col-sm-6 col-lg-4 col-xl-3">
        <div class="card">
          <div class="card-body">
            <div id='speakerChartHint' style="position: absolute; z-index: 1; left: 50%; top: 40%;">
              <div style="position: relative; left: -50%; top: -40%;">
                <center>Start timing speakers to generate the chart!</center>
              </div>
            </div>
            <canvas id="speakerChartCanvas" style="height: 100%;"></canvas>
          </div>
        </div>
      </div>
      <div class="col-sm-6 col-lg-4 col-xl-3">
        <div class="card">
          <div class="card-body">
            <div id='genderChartHint' style="position: absolute; z-index: 1; left: 50%; top: 40%;">
              <div style="position: relative; left: -50%; top: -40%;">
                <center>Add genders to your speakers to see this chart!</center>
              </div>
            </div>
            <canvas id="genderChartCanvas" style="height: 100%;"></canvas>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="tab-pane container col-12" id="aboutTab">
    <div class='row mt-3 col-12'>
      <H3>Who's speaking matters.</H3>
    </div>
    <div class='row col-md-8 col-lg-6 col-xl-4'>
      <p>Research shows that the more diverse a meeting is, the more successful the outcome will be. But it's not enough to simply have a wide range of attendeesâ€”there must be diversity among those actually contributing. That's where <b>Talking Time Tracker</b> comes in.</p>
    </div>

  </div>
</div>
</body>

<!-- Load the external Javascript files -->
<script src="TimedEntity.js"></script>
<script src="TimerControl.js"></script>
<script>

  function cleanName(name) {

    // Clean the name to remove problematic characters.
    name = name.trim(); // Remove leading/trailing whitespace
    name = name.split(' ').join('_'); // Replace spaces with underscores
    name = name.split('.').join('_'); // Periods cause problems with JQuery

    return name;
  }

  // Define the colors that will represent the timedEntities in the chart. Duplicate this to handle a large number of entities.
  var primaryChartColorIterator = 0; // increments to iterate the colors as we add new entities.
  var primaryChartColors = new Array(100).fill(['#3E7CB1', '#FF8360', '#BD619E', '#4C230A', '#5FAD56', '#F4D35E', '#34ADA7', '#8C9051', '#2C517C', '#D12E25', '#7E3F74', '#427046', '#BE972E', '#246C75', '#5C5E3F', '#9BBEDC', '#FFC1B0', '#DEB0CF', '#E78244', '#AFD6AB', '#F9E9AE', '#91DEDA', '#C9CCA4']).flat();

  var tc = new TimerControl();

  $('#addTimedEntityButton').click(function() {tc.createTimedEntity();})
  $('#toggleTiming').click(function() {tc.toggleTiming();})
  $('#noSpeakerButton').click(function() {tc.setActiveEntity(null);})

  var speakerChartOptions = {
  cutoutPercentage: 75,
  responsive: true,
  maintainAspectRatio: false,
  title: {
    text: "Speaker",
    display: true,
    position: 'bottom',
    fontSize: 25,
    padding: 1,
  },
  legend: {
    display: false,
    position:'bottom',
    labels:{
     pointStyle:'circle',
     usePointStyle:true,
     fontSize: 20,
    },
  },
  tooltips: {
    enabled: true,
    bodyFontSize: 20,
    callbacks: {
      label: function(tooltipItems, data) {
        var i = tooltipItems.index
        var labels = [];
          var dateStr = new Date(data.datasets[0].data[i] * 1000).toISOString().substr(11, 8);
          labels.push(data.labels[i] + ": " + dateStr);
        return labels;}
    },
   },
  };

  var speakerChartData = {
      labels: ['No speakers yet'],
      datasets: [
        {
          backgroundColor: primaryChartColors,
          borderWidth: 1,
          data: [0]
        }
      ]
  };

  var speakerChartCanvas = document.getElementById("speakerChartCanvas");
  if (speakerChartCanvas) {
    speakerChart = new Chart(speakerChartCanvas, {
                        type: 'pie',
                        data: speakerChartData,
                        options: speakerChartOptions
                    });
  }

  var genderChartOptions = {
  cutoutPercentage: 50,
  responsive: true,
  maintainAspectRatio: false,
  title: {
    text: "Gender",
    display: true,
    position: 'bottom',
    fontSize: 25,
    padding: 1,
  },
  legend: {
    display: false,
    position:'bottom',
    labels:{
     pointStyle:'circle',
     usePointStyle:true,
     fontSize: 20,
    },
  },
  tooltips: {
    enabled: true,
    bodyFontSize: 20,
    callbacks: {
      label: function(tooltipItems, data) {
        var i = tooltipItems.index
        var labels = [];
        if (tooltipItems.datasetIndex == 0) { // Tooltip is speaking time
          var dateStr = new Date(data.datasets[0].data[i] * 1000).toISOString().substr(11, 8);
          labels.push(data.labels[i] + ": " + dateStr);
        } else {
          var dateStr = data.datasets[1].data[i];
          labels.push(data.labels[i] + ": " + dateStr);
        }

        return labels;}
    },
   },
  };

  var genderChartData = {
      labels: ['No speakers yet'],
      datasets: [
        { // This one holds the speaking time
          backgroundColor: primaryChartColors,
          borderWidth: 1,
          data: [0]
        },
        { // This one holds the number of speakers
          backgroundColor: primaryChartColors,
          borderWidth: 1,
          data: [0]
        }
      ]
  };

  var genderChartCanvas = document.getElementById("genderChartCanvas");
  if (speakerChartCanvas) {
    genderChart = new Chart(genderChartCanvas, {
                        type: 'pie',
                        data: genderChartData,
                        options: genderChartOptions
                    });
  }

</script>
</html>
